<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Akses Satu Kali</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Poppins",sans-serif;
      display:flex;align-items:center;justify-content:center;
      flex-direction:column;
      height:100vh;
      background:linear-gradient(135deg,#e3f2ff,#ffffff);
      color:#222;
      overflow:hidden;
    }
    .container{
      text-align:center;
      padding:30px;
      background:white;
      border-radius:20px;
      box-shadow:0 8px 28px rgba(0,0,0,0.08);
      max-width:380px;
      width:90%;
      animation:fadeIn 0.7s ease;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
    h1{font-size:1.5rem;margin-bottom:12px}
    p{color:#444;margin-bottom:20px}
    .bubble{
      display:inline-block;
      background:#f5faff;
      border:1px solid #cde1ff;
      border-radius:20px;
      padding:10px 16px;
      margin:6px;
      font-size:0.9rem;
      color:#222;
      box-shadow:inset 0 1px 3px rgba(0,0,0,0.05);
      transition:all 0.3s ease;
    }
    .bubble:hover{transform:scale(1.05);}
    .hidden{display:none}
    .dim{
      filter:grayscale(1) brightness(0.9);
      background:white !important;
      color:#aaa !important;
    }
    .footer{
      position:absolute;
      bottom:16px;
      font-size:0.8rem;
      color:#666;
    }
  </style>
</head>
<body>
  <div class="container" id="first">
    <h1>üéâ Selamat Datang!</h1>
    <p>Website ini hanya bisa kamu akses <b>1 kali saja</b>.<br>Data perangkatmu:</p>
    <div id="bubbles"></div>
  </div>

  <div class="container hidden" id="expired">
    <h1>‚ö†Ô∏è Akses Ditolak</h1>
    <p>Web ini sudah kamu buka sebelumnya.<br>Halaman ini kini tidak berguna üòî</p>
    <div id="bubbles2"></div>
  </div>

  <div class="footer">¬© 2025</div>

<script>
async function getIP(){
  try{
    const r=await fetch('https://api.ipify.org?format=json');
    const j=await r.json();
    return j.ip;
  }catch{return "Tidak diketahui";}
}

async function getBattery(){
  try{
    const b=await navigator.getBattery();
    return Math.round(b.level*100)+'%';
  }catch{return "Tidak didukung";}
}

async function getBrightness(){
  try{
    if ('ambientLightSensor' in window) {
      const sensor = new AmbientLightSensor();
      sensor.start();
      return Math.round(sensor.illuminance)+' lux';
    }
    // brightness tidak bisa didapat langsung di browser modern
    // jadi kita ambil dari screen brightness approximate (hack)
    if ('visualViewport' in window) {
      return Math.round((window.visualViewport.scale||1)*100)+'%';
    }
    return "Tidak tersedia";
  }catch{return "Tidak tersedia";}
}

function getTime(){
  const now=new Date();
  return now.toLocaleTimeString('id-ID',{hour12:false});
}

function bubble(id,text){
  const el=document.createElement('div');
  el.className='bubble';
  el.textContent=id+": "+text;
  return el;
}

(async()=>{
  const bubbles=document.getElementById('bubbles');
  const bubbles2=document.getElementById('bubbles2');

  const ip=await getIP();
  const bat=await getBattery();
  const bright=await getBrightness();
  const time=getTime();

  const el1=[bubble("IP",ip),bubble("Batre",bat),bubble("Kecerahan",bright),bubble("Jam",time)];
  el1.forEach(e=>bubbles.appendChild(e));

  const el2=[bubble("IP",ip),bubble("Batre",bat),bubble("Jam",time)];
  el2.forEach(e=>bubbles2.appendChild(e));

  // check access dari API
  try{
    const res=await fetch('/api/access');
    const data=await res.json();

    if (data.allowed){
      localStorage.setItem('visited_one_time','1');
      document.getElementById('expired').classList.add('hidden');
      document.getElementById('first').classList.remove('hidden');
    }else{
      document.body.classList.add('dim');
      document.getElementById('first').classList.add('hidden');
      document.getElementById('expired').classList.remove('hidden');
    }
  }catch(e){
    document.body.innerHTML='<p style="text-align:center;">Gagal memuat data.</p>';
  }
})();
</script>
</body>
</html>
