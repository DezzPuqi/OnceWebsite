<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Akses Sekali Saja</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Poppins",sans-serif;
      display:flex;align-items:center;justify-content:center;
      flex-direction:column;
      height:100vh;
      background:linear-gradient(135deg,#e3f2ff,#ffffff);
      color:#222;
      overflow:hidden;
    }
    .container{
      text-align:center;
      padding:30px;
      background:white;
      border-radius:20px;
      box-shadow:0 8px 28px rgba(0,0,0,0.08);
      max-width:420px;
      width:90%;
      animation:fadeIn 0.7s ease;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
    h1{font-size:1.6rem;margin-bottom:12px}
    p{color:#444;margin-bottom:20px}
    .bubble{
      display:inline-block;
      background:#f5faff;
      border:1px solid #cde1ff;
      border-radius:20px;
      padding:10px 16px;
      margin:6px;
      font-size:0.9rem;
      color:#222;
      box-shadow:inset 0 1px 3px rgba(0,0,0,0.05);
      transition:transform 0.3s ease;
    }
    .bubble:hover{transform:scale(1.05);}
    button{
      background:#0066ff;
      color:#fff;
      border:none;
      padding:10px 22px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      transition:all 0.2s ease;
    }
    button:hover{background:#0052cc;transform:scale(1.05);}
    .hidden{display:none}

    /* Mode expired */
    body.dim{
      background:#f8f8f8;
      color:#aaa;
    }
    body.dim .container{
      background:#fff;
      color:#aaa;
      filter:grayscale(1) brightness(0.8);
      animation:glitch 0.2s infinite;
    }
    @keyframes glitch{
      0%{transform:translate(0)}
      20%{transform:translate(-1px,1px)}
      40%{transform:translate(1px,-1px)}
      60%{transform:translate(-2px,0)}
      80%{transform:translate(2px,1px)}
      100%{transform:translate(0)}
    }
    .noise{
      position:fixed;
      top:0;left:0;width:100%;height:100%;
      pointer-events:none;
      background:repeating-radial-gradient(circle at random,rgba(255,255,255,0.05),transparent 2px);
      animation:noiseMove 0.4s steps(4) infinite;
    }
    @keyframes noiseMove{
      from{background-position:0 0;}
      to{background-position:100% 100%;}
    }
    .footer{position:absolute;bottom:16px;font-size:0.8rem;color:#666;}
  </style>
</head>
<body>
  <div class="container" id="loading">
    <h1>üîç Memeriksa akses...</h1>
    <p>Tunggu sebentar, sedang mengecek status kamu.</p>
  </div>

  <div class="container hidden" id="first">
    <h1>üéâ Selamat Datang!</h1>
    <p>Website ini hanya bisa kamu akses <b>1 kali saja</b>.<br>Data perangkatmu:</p>
    <div id="bubbles"></div>
    <br>
    <button id="goBtn">Lanjutkan ‚ûú</button>
  </div>

  <div class="container hidden" id="expired">
    <h1>‚ö†Ô∏è Akses Sudah Digunakan</h1>
    <p>Halaman ini tidak bisa lagi digunakan.</p>
    <div id="bubbles2"></div>
  </div>

  <div class="footer">¬© 2025</div>
  <div class="noise hidden" id="noise"></div>

<script>
async function getIP(){
  try{
    const r=await fetch('https://api.ipify.org?format=json');
    const j=await r.json();
    return j.ip;
  }catch{return "Tidak diketahui";}
}
async function getBattery(){
  try{
    const b=await navigator.getBattery();
    return Math.round(b.level*100)+'%';
  }catch{return "Tidak didukung";}
}
function getBrightness(){
  try{
    const bright=Math.round(window.visualViewport?.scale*100||100);
    return bright+'%';
  }catch{return "Tidak tersedia";}
}
function getTime(){
  const now=new Date();
  return now.toLocaleTimeString('id-ID',{hour12:false});
}
function bubble(label,text){
  const el=document.createElement('div');
  el.className='bubble';
  el.textContent=label+": "+text;
  return el;
}

(async()=>{
  const bubbles=document.getElementById('bubbles');
  const bubbles2=document.getElementById('bubbles2');
  const noise=document.getElementById('noise');
  const first=document.getElementById('first');
  const expired=document.getElementById('expired');
  const loading=document.getElementById('loading');

  const ip=await getIP();
  const bat=await getBattery();
  const bright=getBrightness();
  const time=getTime();

  const items=[bubble("IP",ip),bubble("Batre",bat),bubble("Kecerahan",bright),bubble("Jam",time)];
  items.forEach(e=>bubbles.appendChild(e));
  const items2=[bubble("IP",ip),bubble("Batre",bat),bubble("Jam",time)];
  items2.forEach(e=>bubbles2.appendChild(e));

  document.getElementById("goBtn").onclick=()=>window.location.href="https://example.com";

  // Cegah tampil apapun sebelum verifikasi
  first.classList.add('hidden');
  expired.classList.add('hidden');
  loading.classList.remove('hidden');

  try{
    const res=await fetch('/api/access');
    const data=await res.json();

    loading.classList.add('hidden'); // setelah cek, baru tampil salah satu

    if (data.allowed){
      localStorage.setItem('visited_one_time','1');
      first.classList.remove('hidden');
    }else{
      document.body.classList.add('dim');
      noise.classList.remove('hidden');
      expired.classList.remove('hidden');
    }
  }catch(e){
    loading.innerHTML="<h1>‚ùå Error</h1><p>Gagal memeriksa akses.</p>";
  }
})();
</script>
</body>
</html>
